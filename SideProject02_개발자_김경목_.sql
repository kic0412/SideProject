CREATE TABLE DOCTORS (
	DOC_ID NUMBER(10) NOT NULL,
	MAJOR_TREAT VARCHAR2(25) NOT NULL,
	DOC_NAME VARCHAR2(20) NOT NULL,
	DOC_GEN CHAR(1) NOT NULL,
	DOC_PHONE VARCHAR2(15) NULL,
	DOC_EMAIL VARCHAR2(20) UNIQUE,
	DOC_POSITION VARCHAR2(20) NOT NULL
);

CREATE TABLE NURSES (
	NUR_ID NUMBER(10) NOT NULL,
	MAJOR_JOB VARCHAR2(25) NOT NULL,
	NUR_NAME VARCHAR2(20) NOT NULL,
	NUR_GEN CHAR(1) NOT NULL,
	NUR_PHONE VARCHAR2(15) NULL,
	NUR_EMAIL VARCHAR2(20) UNIQUE,
	NUR_POSITION VARCHAR2(20) NOT NULL
);

CREATE TABLE PATIENTS(
	PAT_ID NUMBER(10) NOT NULL,
	NUR_ID NUMBER(10) NOT NULL,
	DOC_ID NUMBER(10) NOT NULL,
	PAT_NAME VARCHAR2(20) NOT NULL,
	PAT_GEN CHAR(1) NOT NULL,
	PAT_JUMIN VARCHAR2(14) NOT NULL,
	PAT_ADDR VARCHAR2(100) NOT NULL,
	PAT_PHONE VARCHAR2(15) NULL,
	PAT_EMAIL VARCHAR(50) UNIQUE,
	PAT_JOB VARCHAR(20) NOT NULL
);

CREATE TABLE TREATMENTS (
	TREAT_ID NUMBER(15) NOT NULL,
	PAT_ID NUMBER(10) NOT NULL,
	DOC_ID NUMBER(10) NOT NULL,
	TREAT_CONTENTS VARCHAR2(1000) NOT NULL,
	TREAT_DATE DATE NOT NULL
);

CREATE TABLE CHARTS(
    CHART_ID VARCHAR2(20) NOT NULL,
    TREAT_ID NUMBER(15) NOT NULL,
    DOC_ID NUMBER(10) NOT NULL,
    PAT_ID NUMBER(10) NOT NULL,
    NUR_ID NUMBER(10) NOT NULL,
    CHART_CONTENTS VARCHAR2(1000) NOT NULL
);

ALTER TABLE DOCTORS ADD CONSTRAINT DOC_ID_PK PRIMARY KEY (DOC_ID);

ALTER TABLE NURSES ADD CONSTRAINT NUR_ID_PK PRIMARY KEY (NUR_ID);

ALTER TABLE PATIENTS ADD CONSTRAINT PAT_ID_PK PRIMARY KEY (PAT_ID);

ALTER TABLE TREATMENTS ADD CONSTRAINT TREAT_PAT_DOC_ID_PK PRIMARY KEY( TREAT_ID,PAT_ID,DOC_ID );

ALTER TABLE CHARTS ADD CONSTRAINT CHART_TREAT_DOC_PAT_ID_PK PRIMARY KEY (CHART_ID, TREAT_ID, DOC_ID, PAT_ID);

ALTER TABLE PATIENTS ADD (CONSTRAINT R_2 FOREIGN KEY (DOC_ID) REFERENCES DOCTORS (DOC_ID));

ALTER TABLE PATIENTS ADD (CONSTRAINT R_3 FOREIGN KEY (NUR_ID) REFERENCES NURSES (NUR_ID));

ALTER TABLE TREATMENTS ADD (CONSTRAINT R_5 FOREIGN KEY (PAT_ID) REFERENCES PATIENTS (PAT_ID));

ALTER TABLE TREATMENTS ADD (CONSTRAINT R_6 FOREIGN KEY (DOC_ID) REFERENCES DOCTORS (DOC_ID));

ALTER TABLE CHARTS ADD (CONSTRAINT R_4 FOREIGN KEY (NUR_ID) REFERENCES NURSES (NUR_ID));

ALTER TABLE CHARTS ADD (CONSTRAINT R_7 FOREIGN KEY (TREAT_ID, PAT_ID, DOC_ID) REFERENCES TREATMENTS(TREAT_ID, PAT_ID, DOC_ID));

INSERT INTO DOCTORS VALUES (980312, '소아과', '이태정', 'M', '010-333-1340', 'LTJ@HANBH.COM', '과장');
INSERT INTO DOCTORS VALUES (000601, '내과', '안성기', 'M', '011-222-0987', 'ASK@HANBH.COM', '과장');
INSERT INTO DOCTORS VALUES (001208, '외과', '김민종', 'M', '010-333-8743', 'KMJ@HANBH.COM', '과장');
INSERT INTO DOCTORS VALUES (020403, '피부과', '이태서', 'M', '019-777-3764', 'LTS@HANBH.COM', '과장');
INSERT INTO DOCTORS VALUES (050900, '소아과', '김연아', 'F', '010-555-3746', 'KYA@HANBH.COM', '전문의');
INSERT INTO DOCTORS VALUES (050101, '내과', '차태현', 'M', '011-222-7643', 'CTH@HANBH.COM', '전문의');
INSERT INTO DOCTORS VALUES (062019, '소아과', '전지현', 'F', '010-999-1265', 'JJH@HANBH.COM', '전문의');
INSERT INTO DOCTORS VALUES (070576, '피부과', '홍길동', 'M', '016-333-7263', 'HGD@HANBH.COM', '전문의');
INSERT INTO DOCTORS VALUES (080543, '방사선과', '유재석', 'M', '010-222-1263', 'YJS@HANBH.COM', '과장');
INSERT INTO DOCTORS VALUES (091001, '외과', '김병만', 'M', '010-555-3542', 'KBM@HANBH.COM', '전문의');
INSERT INTO NURSES VALUES (050302, '소아과', '김은영', 'F', '010-555-8751', 'KEY@HANBH.COM ' , '수간호사');
INSERT INTO NURSES VALUES (050021, '내과', '윤성애', 'F', '016-333-8745', 'YSA@HANBH.COM', '수간호사');
INSERT INTO NURSES VALUES (040089, '피부과', '신지원', 'M', '010-666-7646', 'SJW@HANBH.COM', '주임');
INSERT INTO NURSES VALUES (070605, '방사선과', '유정화', 'F', '010-333-4588', 'YJH@HANBH.COM', '주임');
INSERT INTO NURSES VALUES (070804, '내과', '라하나', 'F', '010-222-1340', 'NHN@HANBH.COM', '주임');
INSERT INTO NURSES VALUES (071018, '소아과', '김화경', 'F', '019-888-4116', 'KHK@HANBH.COM', '주임');
INSERT INTO NURSES VALUES (100356, '소아과', '이선용', 'M', '010-777-1234', 'LSY@HANBH.COM', '간호사');
INSERT INTO NURSES VALUES (104145, '외과', '김현', 'M', '010-999-8520', 'KH@HANBH.COM', '간호사');
INSERT INTO NURSES VALUES (120309, '피부과', '박성완', 'M', '010-777-4996', 'PSW@HANBH.COM', '간호사');
INSERT INTO NURSES VALUES (130211, '외과', '이서연', 'F', '010-222-3214', 'LSY2@HANBH.COM', '간호사');
INSERT INTO PATIENTS VALUES (2345, 050302, 980312, '안상건', 'M', '232345', '서울', '010-555-7845', 'ASK@AB.COM', '회사원');
INSERT INTO PATIENTS VALUES (3545, 040089, 020403, '김성룡', 'M', '543545', '서울', '010-333-7812', 'KSR@BB.COM', '자영업');
INSERT INTO PATIENTS VALUES (3424, 070605, 080543, '이종진', 'M', '433424', '부산', '010-888-4859', 'IJJ@AB.COM', '회사원');
INSERT INTO PATIENTS VALUES (7675, 100356, 050900, '최광석', 'M', '677675', '당진', '010-222-4847', 'CKS@CC.COM', '회사원');
INSERT INTO PATIENTS VALUES (4533, 070804, 000601, '정한경', 'M', '744533', '강릉', '010-777-9630', 'JHK@AB.COM', '교수');
INSERT INTO PATIENTS VALUES (5546, 120309, 070576, '유원현', 'M', '765546', '대구', '010-777-0214', 'YWH@CC.COM', '자영업');
INSERT INTO PATIENTS VALUES (4543, 070804, 050101, '최재정', 'M', '454543', '부산', '010-555-4187', 'CJJ@BB.COM', '회사원');
INSERT INTO PATIENTS VALUES (9768, 130211, 091001, '이진희', 'F', '119768', '서울', '010-888-3675', 'IJH@AB.COM', '교수');
INSERT INTO PATIENTS VALUES (4234, 130211, 091001, '오나미', 'F', '234234', '속초', '010-999-6541', 'ONM@CC.COM', '학생');
INSERT INTO PATIENTS VALUES (7643, 071018, 062019, '송성묵', 'M', '987643', '서울', '010-222-5874', 'SSM@BB.COM', '학생');
INSERT INTO TREATMENTS VALUES (130516023, 2345, 980312, '감기,몸살','2013-05-16');
INSERT INTO TREATMENTS VALUES (130628100, 3545, 020403, '피부 트러블 치료', '2013-05-16');
INSERT INTO TREATMENTS VALUES (131205056, 3424, 080543, '목디스크로 MRI 촬영', '2013-12-05');
INSERT INTO TREATMENTS VALUES (131218024, 7675, 050900, '중이염', '2013-12-18');
INSERT INTO TREATMENTS VALUES (131224012, 4533, 000601, '장염', '2013-12-24');
INSERT INTO TREATMENTS VALUES (140103001, 5546, 070576, '여드름 치료', '2014-01-03');
INSERT INTO TREATMENTS VALUES (140109026, 4543, 050101, '위염', '2014-01-09');
INSERT INTO TREATMENTS VALUES (140226102, 9768, 091001, '화상 치료', '2014-02-26');
INSERT INTO TREATMENTS VALUES (140303003, 4234, 091001, '교통사고 외상 치료', '2014-03-03');
INSERT INTO TREATMENTS VALUES (140308087, 7643, 062019, '장염', '2014-03-08'); 
INSERT INTO CHARTS VALUES ('P_130516023', 130516023, 980312, 2345, 050302, '감기 주사 및 약 처방');
INSERT INTO CHARTS VALUES ('D_130628100', 130628100, 020403, 3545, 040089, '피부 감염 방지 주사');
INSERT INTO CHARTS VALUES ('R_131205056', 131205056, 080543, 3424, 070605, '주사 처방');
INSERT INTO CHARTS VALUES ('P_131218024', 131218024, 050900, 7675, 100356, '귓속 청소 및 약 처방');
INSERT INTO CHARTS VALUES ('I_131224012', 131224012, 000601, 4533, 070804, '장염 입원 치료');
INSERT INTO CHARTS VALUES ('D_140103001', 140103001, 070576, 5546, 120309, '여드름 치료약 처방');
INSERT INTO CHARTS VALUES ('I_140109026', 140109026, 050101, 4543, 070804, '위내시경');
INSERT INTO CHARTS VALUES ('S_140226102', 140226102, 091001, 9768, 130211, '화상 크림약 처방');
INSERT INTO CHARTS VALUES ('S_140303003', 140303003, 091001, 4234, 130211, '입원 치료');
INSERT INTO CHARTS VALUES ('P_140308087', 140308087, 062019, 7643, 071018, '장염 입원 치료');

UPDATE DOCTORS SET MAJOR_TREAT = '소아과' WHERE DOC_NAME = '홍길동';
SELECT * FROM DOCTORS;

DELETE FROM NURSES WHERE NUR_NAME = '김은영'; 

ALTER TABLE PATIENTS DROP CONSTRAINT "R_3";
ALTER TABLE CHARTS DROP CONSTRAINT "R_4";

SELECT * FROM NURSES;

SELECT * FROM DOCTORS WHERE MAJOR_TREAT = '소아과';

SELECT P.*, D.DOC_NAME FROM DOCTORS D JOIN PATIENTS P ON (D.DOC_ID = P.DOC_ID) WHERE D.DOC_NAME = '홍길동';

SELECT P.*, T.TREAT_DATE 
FROM TREATMENTS T JOIN PATIENTS P ON (T.PAT_ID = P.PAT_ID)
WHERE T.TREAT_DATE BETWEEN '2013-12-01' AND '2013-12-31'
ORDER BY T.TREAT_DATE ASC;

SELECT * FROM NURSES WHERE LPAD(nur_id,6,'0') like '05%';